<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QUOXT SS - Apostas</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.10.0/dist/web3.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Arial', sans-serif; background-color: #1c2526; color: #ffffff; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 10px; background: #141a1f; min-height: 100vh; display: flex; flex-direction: column; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #2e2e2e; }
        h1 { font-size: 20px; color: #f0b90b; }
        .crypto-nav { display: flex; gap: 5px; }
        .crypto-btn { padding: 6px 12px; background-color: #2e2e2e; color: #ffffff; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; transition: background-color 0.3s; }
        .crypto-btn.active { background-color: #f0b90b; color: #141a1f; }
        .crypto-btn:hover:not(.active) { background-color: #3e3e3e; }
        .connect-btn-header { padding: 6px 12px; background-color: #f0b90b; color: #141a1f; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; transition: background-color 0.3s; }
        .connect-btn-header:hover { background-color: #ffcc00; }
        .main-content { display: flex; flex: 1; margin-top: 10px; }
        .chart-container { flex: 3; display: flex; flex-direction: column; }
        .chart-area { flex: 1; padding-right: 10px; }
        canvas { width: 100% !important; height: 500px !important; display: none; background: #1c2526; border: 1px solid #2e2e2e; border-radius: 4px; }
        #bnbChart { display: block; }
        .bottom-buttons { display: flex; gap: 5px; padding-top: 10px; }
        .bottom-btn { padding: 4px 8px; border: none; border-radius: 4px; cursor: pointer; font-size: 10px; transition: background-color 0.3s; }
        .sacar-btn { background-color: #f0b90b; color: #141a1f; }
        .sacar-btn:hover { background-color: #ffcc00; }
        .deposito-btn { background-color: #f0b90b; color: #141a1f; }
        .deposito-btn:hover { background-color: #ffcc00; }
        .demo-btn { background-color: #2e2e2e; color: #ffffff; }
        .demo-btn:hover { background-color: #3e3e3e; }
        .demo-btn.active { background-color: #00c087; }
        .controls { width: 250px; background: #1c2526; padding: 10px; border-radius: 4px; border: 1px solid #2e2e2e; display: flex; flex-direction: column; gap: 8px; }
        .controls p { margin: 5px 0; font-size: 12px; }
        .wallet-info { background: #141a1f; padding: 8px; border-radius: 4px; border: 1px solid #3e3e3e; transition: all 0.3s ease; }
        #carteiraInfo { color: #f0b90b; font-size: 12px; }
        #saldoReal, #saldoDemo { color: #ffffff; font-size: 12px; margin-top: 5px; }
        #saldoReal span, #saldoDemo span { color: #f0b90b; }
        #valorAposta, #tempoExpiracao { padding: 6px; background: #141a1f; border: 1px solid #3e3e3e; border-radius: 4px; color: #ffffff; width: 100%; font-size: 12px; }
        .bet-buttons { display: flex; flex-direction: column; gap: 8px; }
        .bet-btn { padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px; transition: background-color 0.3s; }
        .up { background-color: #00c087; color: #ffffff; }
        .up:hover { background-color: #00e0a0; }
        .down { background-color: #ff4d4d; color: #ffffff; }
        .down:hover { background-color: #ff6666; }
        #resultado, #tempoRestante, #usuáriosAtivos { margin: 5px 0; font-size: 12px; }
        #usuáriosAtivos span { color: #f0b90b; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); }
        .modal-content { background: #1c2526; margin: 15% auto; padding: 15px; width: 300px; border-radius: 4px; border: 1px solid #2e2e2e; color: #ffffff; }
        .close { float: right; cursor: pointer; font-size: 20px; color: #ff4d4d; }
        .close:hover { color: #ff6666; }
        input[type="text"], input[type="number"], textarea { width: 100%; padding: 8px; margin: 5px 0; background: #141a1f; border: 1px solid #3e3e3e; border-radius: 4px; color: #ffffff; font-size: 12px; }
        .support-icon { position: fixed; bottom: 10px; right: 10px; width: 40px; height: 40px; background-color: #f0b90b; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3); transition: background-color 0.3s; }
        .support-icon:hover { background-color: #ffcc00; }
        .support-icon::before { content: "?"; font-size: 20px; color: #141a1f; }
        .history { margin-top: 10px; background: #1c2526; padding: 10px; border-radius: 4px; border: 1px solid #2e2e2e; }
        .history h2 { font-size: 16px; color: #f0b90b; margin-bottom: 5px; }
        .history-table { width: 100%; border-collapse: collapse; font-size: 12px; }
        .history-table th, .history-table td { padding: 8px; text-align: left; border-bottom: 1px solid #2e2e2e; }
        .history-table th { color: #f0b90b; }
        .history-table td { color: #d0d0d0; }
        .history-table tr:last-child td { border-bottom: none; }
        .affiliate-section { margin-top: 10px; background: #1c2526; padding: 10px; border-radius: 4px; border: 1px solid #2e2e2e; }
        .affiliate-section h2 { font-size: 16px; color: #f0b90b; margin-bottom: 5px; }
        .affiliate-btn { padding: 4px 8px; background-color: #f0b90b; color: #141a1f; border: none; border-radius: 4px; cursor: pointer; font-size: 10px; transition: background-color 0.3s; }
        .affiliate-btn:hover { background-color: #ffcc00; }
        #affiliateCode, #affiliateStats { font-size: 12px; margin-top: 5px; }
        .saques-window { background: #1c2526; padding: 8px; border-radius: 4px; border: 1px solid #2e2e2e; margin-top: 10px; width: 100%; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.5); }
        .saques-window h2 { font-size: 12px; color: #f0b90b; margin-bottom: 6px; }
        .saques-list { max-height: 100px; overflow-y: auto; }
        .saque-item { display: flex; justify-content: space-between; padding: 4px 0; font-size: 10px; border-bottom: 1px solid #2e2e2e; }
        .saque-item:last-child { border-bottom: none; }
        .saque-valor { color: #f0b90b; }
        .proprietario-modal .modal-content { width: 500px; padding: 20px; }
        .proprietario-modal h2 { font-size: 16px; color: #f0b90b; margin-bottom: 10px; }
        .conta-item { display: flex; justify-content: space-between; padding: 5px 0; font-size: 12px; border-bottom: 1px solid #2e2e2e; }
        .conta-item:last-child { border-bottom: none; }
        .total-valor { font-size: 14px; color: #f0b90b; margin-top: 10px; }
        .toggle-chart-btn { padding: 6px 12px; background-color: #00c087; color: #ffffff; border: none; border-radius: 4px; cursor: pointer; font-size: 12px; margin-top: 10px; transition: background-color 0.3s; }
        .toggle-chart-btn:hover { background-color: #00e0a0; }
        .toggle-chart-btn.off { background-color: #ff4d4d; }
        .toggle-chart-btn.off:hover { background-color: #ff6666; }
        #dificuldadeChartContainer { margin-top: 15px; display: none; }
    </style>
<!-- Code injected by Five-server -->
  <script async data-id="five-server" data-file="c:\Users\thiago\Desktop\indexggg\index.html" type="application/javascript" src="/fiveserver.js"></script>
  </head>
<body>
    <div class="container">
        <div class="header">
            <button class="connect-btn-header" onclick="abrirJanelaCarteira()">Conectar</button>
            <h1>QUOXT SS</h1>
            <div class="crypto-nav">
                <button class="crypto-btn active" id="bnbBtn" onclick="mostrarGrafico('bnb')">BNB</button>
                <button class="crypto-btn" id="btcBtn" onclick="mostrarGrafico('btc')">BTC</button>
                <button class="crypto-btn" id="ethBtn" onclick="mostrarGrafico('eth')">ETH</button>
                <button class="crypto-btn" id="usdtBtn" onclick="mostrarGrafico('usdt')">USDT</button>
            </div>
        </div>
        <div class="main-content">
            <div class="chart-container">
                <div class="chart-area">
                    <canvas id="bnbChart"></canvas>
                    <canvas id="btcChart"></canvas>
                    <canvas id="ethChart"></canvas>
                    <canvas id="usdtChart"></canvas>
                </div>
                <div class="bottom-buttons">
                    <button class="bottom-btn sacar-btn" id="transferirBtn" onclick="transferirSaldo()">Sacar</button>
                    <button class="bottom-btn deposito-btn" onclick="realizarDeposito()">Depositar</button>
                    <button class="bottom-btn demo-btn" id="demoBtn" onclick="toggleDemoMode()">Demonstração</button>
                    <button class="bottom-btn" style="background-color: #00c087;" onclick="abrirJanelaProprietario()">Proprietário</button>
                </div>
            </div>
            <div class="controls">
                <div class="wallet-info">
                    <p>Carteira: <span id="carteiraInfo">Não conectado</span></p>
                    <p id="saldoReal">Saldo Real: <span>0.0000 BNB (R$ 0.00)</span></p>
                    <p id="saldoDemo">Saldo Demo: <span>0.0000 BNB (R$ 0.00)</span></p>
                </div>
                <p>Valor da aposta: <input type="number" id="valorAposta" min="0.0001" max="100" value="0.0001" step="0.0001"></p>
                <p>Tempo de expiração:<select id="tempoExpiracao">
                    <option value="30">30s</option>
                    <option value="60" selected>1m</option>
                    <option value="120">2m</option>
                    <option value="180">3m</option>
                    <option value="300">5m</option>
                </select></p>
                <div class="bet-buttons">
                    <button class="bet-btn up" onclick="apostar('cima')">Apostar para Cima</button>
                    <button class="bet-btn down" onclick="apostar('baixo')">Apostar para Baixo</button>
                </div>
                <div id="resultado">Resultado: Aguardando aposta...</div>
                <div id="tempoRestante">Tempo restante: 1:00</div>
                <div class="saques-window">
                
                    <div class="saques-list" id="saquesList"></div>
                </div>
            </div>
        </div>
        <div class="history">
            <h2>Histórico de Apostas</h2>
            <table class="history-table" id="historyTable">
                <thead>
                    <tr>
                        <th>Data/Hora</th>
                        <th>Direção</th>
                        <th>Valor (BNB)</th>
                        <th>Resultado</th>
                    </tr>
                </thead>
                <tbody id="historyBody"></tbody>
            </table>
        </div>
        <div class="affiliate-section">
            <h2>Programa de Afiliados</h2>
            <button class="affiliate-btn" onclick="gerarCodigoAfiliado()">Seja Afiliado</button>
            <p id="affiliateCode"></p>
            <div id="affiliateStats"> Usuários Cadastrados: <span id="usuariosAfiliados">0</span><br> Valor para Saque: <span id="valorAfiliado">0</span> BNB </div>
            <button class="affiliate-btn" onclick="solicitarSaqueAfiliado()">Solicitar Saque</button>
        </div>
    </div>
    <!-- Janela Modal para Conectar Carteira -->
    <div id="carteiraModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharJanelaCarteira()">×</span>
            <h2>Conectar Carteira BNB</h2>
            <p>Conectar via MetaMask:</p>
            <button class="connect-btn-header" onclick="conectarMetaMask()">MetaMask</button>
            <p>Código de Afiliado (opcional):</p>
            <input type="text" id="codigoAfiliado" placeholder="Digite o código">
        </div>
    </div>
    <!-- Janela Modal para Depósito -->
    <div id="depositoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharJanelaDeposito()">×</span>
            <h2>Realizar Depósito</h2>
            <p>Valor em BNB:</p>
            <input type="number" id="valorDeposito" min="0.001" step="0.001" placeholder="Ex: 0.00002">
            <button class="connect-btn-header" onclick="depositarBNB()">Confirmar</button>
            <p id="statusDeposito">Status: Aguardando ação...</p>
        </div>
    </div>
    <!-- Janela Modal para Suporte -->
    <div id="suporteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="fecharJanelaSuporte()">×</span>
            <h2>Suporte</h2>
            <p>Enviar sua mensagem:</p>
            <textarea id="mensagemSuporte" rows="4" placeholder="Digite aqui..."></textarea>
            <button class="connect-btn-header" onclick="enviarMensagemSuporte()">Enviar</button>
        </div>
    </div>
    <!-- Janela Modal Proprietária -->
    <div id="proprietarioModal" class="modal proprietario-modal">
        <div class="modal-content">
            <span class="close" onclick="fecharJanelaProprietario()">×</span>
            <h2>Painel Proprietário</h2>
            <div id="contasLogadas"></div>
            <div class="total-valor">Valor Total do Site: <span id="valorTotalSite">0</span> BNB</div>
            <button class="toggle-chart-btn" id="toggleChartBtn" onclick="toggleDificuldadeChart()">Ativar Gráfico Dificuldade</button>
            <div id="dificuldadeChartContainer">
                <canvas id="dificuldadeChart"></canvas>
            </div>
        </div>
    </div>
    <!-- Ícone de Suporte -->
    <div class="support-icon" onclick="abrirJanelaSuporte()"></div>
    <!-- Elementos de Áudio -->
    <audio id="entradaSom" src="https://www.soundjay.com/buttons/beep-01a.mp3"></audio>
    <audio id="winSound" src="https://www.soundjay.com/buttons/beep-07a.mp3"></audio>
    <audio id="loseSound" src="https://www.soundjay.com/buttons/beep-02.mp3"></audio>
    <script>
        let saldoReal = 0;
        let saldoDepositado = localStorage.getItem('saldoDepositado') ? parseFloat(localStorage.getItem('saldoDepositado')) : 0;
        let saldoDemo = 0;
        let tempoRestante = 60;
        const MINIMO_SAQUE = 0.023479184927942306;
        const SALDO_INICIAL_DEMO = 10;
        const BONUS_PRIMEIRO_LOGIN = 0.004; // R$ 10 / R$ 2500 por BNB = 0.004 BNB
        let historicoApostas = [];
        let historicoApostasDemo = [];
        let afiliadoCode = "";
        let usuariosAfiliados = 0;
        let valorAfiliado = 0;
        let codigoAfiliadoInserido = "";
        const afiliados = {};
        const CARTEIRA_PROPRIETARIA = "0xbc1EA5fa6C39b2BcDd7621E8d674Ff196aA6d6Cb";
        let valorTotalSite = localStorage.getItem('valorTotalSite') ? parseFloat(localStorage.getItem('valorTotalSite')) : 0;
        let dificuldadeChartAtivo = false;
        let dificuldadeChart = null;
        let contasLogadas = JSON.parse(localStorage.getItem('contasLogadas')) || [];
        const web3 = new Web3('https://bsc-dataseed.binance.org/');
        let isDemoMode = false;
        let apostaAtiva = null;
        let criptoAtual = 'bnb';
        let carteiraBNB = localStorage.getItem('carteiraBNB') || "";
        let primeiroLogin = localStorage.getItem('primeiroLogin') !== 'false'; // Verifica se é o primeiro login
        const criptomoedas = {
            bnb: { dataPoints: [500], labels: ["0s"], chart: null },
            btc: { dataPoints: [60000], labels: ["0s"], chart: null },
            eth: { dataPoints: [3000], labels: ["0s"], chart: null },
            usdt: { dataPoints: [1], labels: ["0s"], chart: null }
        };

        // Cotação fictícia de BNB para BRL
        let cotacaoBNBparaBRL = 2500; // 1 BNB = R$ 2.500,00

        // Função para converter BNB para BRL
        function converterBNBparaBRL(valorBNB) {
            return (valorBNB * cotacaoBNBparaBRL).toFixed(2);
        }

        // Função para atualizar a exibição da carteira e saldos
        function atualizarExibicaoCarteira() {
            const carteiraInfo = document.getElementById("carteiraInfo");
            const saldoRealElement = document.getElementById("saldoReal");
            const saldoDemoElement = document.getElementById("saldoDemo");

            carteiraInfo.textContent = isDemoMode ? "Conta Demo" : (carteiraBNB ? `${carteiraBNB.slice(0, 6)}...${carteiraBNB.slice(-4)}` : "Não conectado");
            saldoRealElement.innerHTML = `Saldo Real: <span>${saldoDepositado.toFixed(4)} BNB (R$ ${converterBNBparaBRL(saldoDepositado)})</span>`;
            saldoDemoElement.innerHTML = `Saldo Demo: <span>${saldoDemo.toFixed(4)} BNB (R$ ${converterBNBparaBRL(saldoDemo)})</span>`;
        }

        const drawPlayerEntry = {
            id: 'drawPlayerEntry',
            afterDraw(chart) {
                if (!apostaAtiva) return;
                const { ctx, chartArea, scales } = chart;
                const y = scales.y.getPixelForValue(apostaAtiva.precoEntrada);
                const lastIndex = chart.data.labels.length - 1;
                const x = scales.x.getPixelForValue(lastIndex);
                ctx.save();
                ctx.beginPath();
                ctx.strokeStyle = '#ffffff';
                ctx.lineWidth = 2;
                ctx.setLineDash([5, 5]);
                ctx.moveTo(chartArea.left, y);
                ctx.lineTo(chartArea.right, y);
                ctx.stroke();
                ctx.restore();
                ctx.save();
                ctx.beginPath();
                if (apostaAtiva.direcao === 'cima') {
                    ctx.fillStyle = '#00c087';
                    ctx.moveTo(x, y - 15);
                    ctx.lineTo(x - 10, y + 5);
                    ctx.lineTo(x + 10, y + 5);
                } else {
                    ctx.fillStyle = '#ff4d4d';
                    ctx.moveTo(x, y + 15);
                    ctx.lineTo(x - 10, y - 5);
                    ctx.lineTo(x + 10, y - 5);
                }
                ctx.closePath();
                ctx.fill();
                ctx.restore();
            }
        };

        function criarGrafico(cripto, id) {
            const ctx = document.getElementById(id).getContext('2d');
            const chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: criptomoedas[cripto].labels,
                    datasets: [{
                        label: `Preço do ${cripto.toUpperCase()}`,
                        data: criptomoedas[cripto].dataPoints,
                        borderColor: ctx => {
                            const index = ctx.dataIndex;
                            if (index === 0) return '#f0b90b';
                            const prevPrice = criptomoedas[cripto].dataPoints[index - 1];
                            const currPrice = criptomoedas[cripto].dataPoints[index];
                            return currPrice > prevPrice ? '#00c087' : '#ff4d4d';
                        },
                        borderWidth: 2,
                        fill: false,
                        segment: {
                            borderColor: ctx => {
                                const index = ctx.p1DataIndex;
                                if (index === 0) return '#f0b90b';
                                const prevPrice = criptomoedas[cripto].dataPoints[index - 1];
                                const currPrice = criptomoedas[cripto].dataPoints[index];
                                return currPrice > prevPrice ? '#00c087' : '#ff4d4d';
                            }
                        }
                    }]
                },
                options: {
                    animation: false,
                    scales: {
                        y: { beginAtZero: false, grid: { color: '#2e2e2e' }, ticks: { color: '#ffffff', font: { size: 12 } } },
                        x: { grid: { color: '#2e2e2e' }, ticks: { color: '#ffffff', font: { size: 12 } } }
                    },
                    plugins: { legend: { display: false } }
                },
                plugins: [drawPlayerEntry]
            });
            return chart;
        }

        criptomoedas.bnb.chart = criarGrafico('bnb', 'bnbChart');
        criptomoedas.btc.chart = criarGrafico('btc', 'btcChart');
        criptomoedas.eth.chart = criarGrafico('eth', 'ethChart');
        criptomoedas.usdt.chart = criarGrafico('usdt', 'usdtChart');

        function atualizarGrafico(cripto) {
            const data = criptomoedas[cripto];
            let novoPreco = data.dataPoints[data.dataPoints.length - 1] + (Math.random() * (cripto === 'usdt' ? 0.01 : 4) - (cripto === 'usdt' ? 0.005 : 2));
            data.dataPoints.push(novoPreco);
            data.labels.push(`${data.labels.length}s`);
            if (data.dataPoints.length > 60) {
                data.dataPoints.shift();
                data.labels.shift();
            }
            data.chart.update();
        }

        function simularUsuariosAtivos() {
            const variacao = Math.floor(Math.random() * 11) - 5;
            usuáriosAtivos = Math.max(690, Math.min(1400, usuáriosAtivos + variacao));
            document.getElementById("numeroUsuarios").innerText = usuáriosAtivos;
        }

        setInterval(() => {
            atualizarGrafico('bnb');
            atualizarGrafico('btc');
            atualizarGrafico('eth');
            atualizarGrafico('usdt');
        }, 1000);

        setInterval(simularUsuariosAtivos, 3000);

        function mostrarGrafico(cripto) {
            criptoAtual = cripto;
            document.querySelectorAll('canvas').forEach(canvas => canvas.style.display = 'none');
            document.getElementById(`${cripto}Chart`).style.display = 'block';
            document.querySelectorAll('.crypto-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${cripto}Btn`).classList.add('active');
            if (apostaAtiva) {
                criptomoedas[cripto].chart.update();
            }
        }

        function formatarTempo(segundos) {
            const minutos = Math.floor(segundos / 60);
            const segs = segundos % 60;
            return `${minutos}:${segs < 10 ? '0' + segs : segs}`;
        }

        async function tentarReconectarCarteira() {
            if (window.ethereum && carteiraBNB) {
                try {
                    const accounts = await window.ethereum.request({ method: 'eth_accounts' });
                    if (accounts.length > 0 && accounts[0].toLowerCase() === carteiraBNB.toLowerCase()) {
                        await atualizarSaldoReal();
                        atualizarExibicaoCarteira();
                        if (!contasLogadas.some(c => c.carteira.toLowerCase() === carteiraBNB.toLowerCase())) {
                            contasLogadas.push({ carteira: carteiraBNB, saldo: saldoDepositado });
                            localStorage.setItem('contasLogadas', JSON.stringify(contasLogadas));
                        }
                        if (carteiraBNB.toLowerCase() === CARTEIRA_PROPRIETARIA.toLowerCase()) {
                            await atualizarPainelProprietario();
                        }
                    } else {
                        carteiraBNB = "";
                        localStorage.removeItem('carteiraBNB');
                        localStorage.removeItem('saldoDepositado');
                        saldoDepositado = 0;
                        atualizarExibicaoCarteira();
                    }
                } catch (error) {
                    console.log("Erro ao reconectar automaticamente:", error);
                    carteiraBNB = "";
                    localStorage.removeItem('carteiraBNB');
                    localStorage.removeItem('saldoDepositado');
                    saldoDepositado = 0;
                    atualizarExibicaoCarteira();
                }
            }
        }

        async function atualizarSaldoReal() {
            if (carteiraBNB && !isDemoMode) {
                try {
                    const balanceWei = await web3.eth.getBalance(carteiraBNB);
                    saldoReal = parseFloat(web3.utils.fromWei(balanceWei, 'ether'));
                    atualizarExibicaoCarteira();
                } catch (error) {
                    console.log("Erro ao atualizar saldo real:", error);
                    saldoReal = 0;
                    atualizarExibicaoCarteira();
                }
            }
        }

        function toggleDemoMode() {
            const demoBtn = document.getElementById("demoBtn");
            const transferirBtn = document.getElementById("transferirBtn");
            if (apostaAtiva) {
                alert("Não é possível ativar o modo demo enquanto uma aposta estiver ativa! Aguarde o término da aposta.");
                return;
            }
            isDemoMode = !isDemoMode;
            if (isDemoMode) {
                demoBtn.textContent = "Demonstração (Ativo)";
                demoBtn.classList.add("active");
                saldoDemo = SALDO_INICIAL_DEMO;
                carteiraBNB = "Conta Demo";
                atualizarExibicaoCarteira();
                transferirBtn.disabled = true;
                afiliadoCode = "";
                usuariosAfiliados = 0;
                valorAfiliado = 0;
                historicoApostasDemo = [];
                atualizarStatsAfiliado();
                document.getElementById("affiliateCode").innerText = "";
                atualizarHistórico();
                alert("Modo Demo ativado! Saldo inicial: 10 BNB. Apostas no modo demo são simuladas.");
            } else {
                demoBtn.textContent = "Demonstração";
                demoBtn.classList.remove("active");
                saldoDemo = 0;
                carteiraBNB = localStorage.getItem('carteiraBNB') || "";
                codigoAfiliadoInserido = "";
                atualizarExibicaoCarteira();
                transferirBtn.disabled = false;
                afiliadoCode = "";
                usuariosAfiliados = 0;
                valorAfiliado = 0;
                historicoApostasDemo = [];
                atualizarStatsAfiliado();
                document.getElementById("affiliateCode").innerText = "";
                atualizarHistórico();
                alert("Modo Demo desativado! Voltando ao modo real.");
                tentarReconectarCarteira();
            }
        }

        function abrirJanelaCarteira() {
            if (isDemoMode) {
                alert("No modo demo, a carteira é simulada.");
                return;
            }
            document.getElementById("carteiraModal").style.display = "block";
        }

        function fecharJanelaCarteira() {
            document.getElementById("carteiraModal").style.display = "none";
            document.getElementById("codigoAfiliado").value = "";
        }

        async function conectarMetaMask() {
            if (isDemoMode) {
                alert("Desative o modo de demonstração para conectar uma carteira real");
                return;
            }
            if (!window.ethereum) {
                alert("Instale o MetaMask!");
                return;
            }
            try {
                const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                carteiraBNB = accounts[0];
                localStorage.setItem('carteiraBNB', carteiraBNB);
                if (primeiroLogin) {
                    saldoDepositado += BONUS_PRIMEIRO_LOGIN;
                    localStorage.setItem('saldoDepositado', saldoDepositado);
                    localStorage.setItem('primeiroLogin', 'false');
                    primeiroLogin = false;
                    alert(`Bem-vindo! Você recebeu um bônus de ${BONUS_PRIMEIRO_LOGIN} BNB (R$ 10) pelo primeiro login.`);
                }
                codigoAfiliadoInserido = document.getElementById("codigoAfiliado").value.trim();
                if (codigoAfiliadoInserido && afiliados[codigoAfiliadoInserido] && afiliados[codigoAfiliadoInserido].carteira !== carteiraBNB) {
                    afiliados[codigoAfiliadoInserido].usuarios = (afiliados[codigoAfiliadoInserido].usuarios || 0) + 1;
                    console.log(`Usuário registrado com código ${codigoAfiliadoInserido}`);
                } else {
                    codigoAfiliadoInserido = "";
                }
                await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x38' }] });
                await atualizarSaldoReal();
                atualizarExibicaoCarteira();
                if (!contasLogadas.some(c => c.carteira.toLowerCase() === carteiraBNB.toLowerCase())) {
                    contasLogadas.push({ carteira: carteiraBNB, saldo: saldoDepositado });
                    localStorage.setItem('contasLogadas', JSON.stringify(contasLogadas));
                }
                fecharJanelaCarteira();
                atualizarStatsAfiliado();
                if (carteiraBNB.toLowerCase() === CARTEIRA_PROPRIETARIA.toLowerCase()) {
                    await atualizarPainelProprietario();
                    abrirJanelaProprietario();
                }
            } catch (error) {
                alert("Erro ao conectar: " + error.message);
                carteiraBNB = "";
                localStorage.removeItem('carteiraBNB');
                localStorage.removeItem('saldoDepositado');
                saldoDepositado = 0;
                atualizarExibicaoCarteira();
            }
        }

        async function apostar(direcao) {
            if (apostaAtiva) {
                alert("Aguarde a aposta anterior!");
                return;
            }
            if (isDemoMode) {
                let valorAposta = parseFloat(document.getElementById("valorAposta").value);
                let tempoSelecionado = parseInt(document.getElementById("tempoExpiracao").value);
                if (saldoDemo < valorAposta) {
                    alert(`Saldo demo insuficiente! Saldo atual: ${saldoDemo.toFixed(4)} BNB`);
                    return;
                }
                saldoDemo -= valorAposta;
                atualizarExibicaoCarteira();
                apostaAtiva = {
                    direcao,
                    valor: valorAposta,
                    precoEntrada: criptomoedas[criptoAtual].dataPoints[criptomoedas[criptoAtual].dataPoints.length - 1],
                    tempoExpiracao: tempoSelecionado,
                    criptoOrigem: criptoAtual,
                    isDemo: true
                };
                tempoRestante = tempoSelecionado;
                document.getElementById("resultado").innerText = "Aposta em andamento (Demo)...";
                document.getElementById("tempoRestante").innerText = `Tempo restante: ${formatarTempo(tempoRestante)}`;
                criptomoedas[criptoAtual].chart.update();
                document.getElementById("entradaSom").play().catch(error => console.log("Erro ao tocar som:", error));
                iniciarContagemRegressiva();
                return;
            }
            if (!carteiraBNB || carteiraBNB === "Conta Demo") {
                alert("Você precisa estar logado com uma carteira real para apostar! Conecte sua carteira agora.");
                abrirJanelaCarteira();
                return;
            }
            let valorAposta = parseFloat(document.getElementById("valorAposta").value);
            let tempoSelecionado = parseInt(document.getElementById("tempoExpiracao").value);
            if (saldoDepositado < valorAposta) {
                alert(`Saldo depositado insuficiente! Saldo atual: ${saldoDepositado.toFixed(4)} BNB`);
                return;
            }
            saldoDepositado -= valorAposta;
            localStorage.setItem('saldoDepositado', saldoDepositado);
            atualizarExibicaoCarteira();
            apostaAtiva = {
                direcao,
                valor: valorAposta,
                precoEntrada: criptomoedas[criptoAtual].dataPoints[criptomoedas[criptoAtual].dataPoints.length - 1],
                tempoExpiracao: tempoSelecionado,
                criptoOrigem: criptoAtual,
                isDemo: false
            };
            tempoRestante = tempoSelecionado;
            document.getElementById("resultado").innerText = "Aposta em andamento...";
            document.getElementById("tempoRestante").innerText = `Tempo restante: ${formatarTempo(tempoRestante)}`;
            criptomoedas[criptoAtual].chart.update();
            document.getElementById("entradaSom").play().catch(error => console.log("Erro ao tocar som:", error));
            iniciarContagemRegressiva();
        }

        function iniciarContagemRegressiva() {
            let timer = setInterval(() => {
                document.getElementById("tempoRestante").innerText = `Tempo restante: ${formatarTempo(tempoRestante)}`;
                tempoRestante--;
                if (tempoRestante < 0) {
                    clearInterval(timer);
                    finalizarAposta();
                }
            }, 1000);
        }

        async function finalizarAposta() {
            let precoFinal = criptomoedas[apostaAtiva.criptoOrigem].dataPoints[criptomoedas[apostaAtiva.criptoOrigem].dataPoints.length - 1];
            let ganhou = (apostaAtiva.direcao === 'cima' && precoFinal > apostaAtiva.precoEntrada) || (apostaAtiva.direcao === 'baixo' && precoFinal < apostaAtiva.precoEntrada);
            if (apostaAtiva.isDemo) {
                if (ganhou) {
                    saldoDemo += apostaAtiva.valor * 2;
                }
                atualizarExibicaoCarteira();
                document.getElementById("resultado").innerText = ganhou ? "Você ganhou! (Demo)" : "Você perdeu! (Demo)";
                const dataHora = new Date().toLocaleString('pt-BR');
                historicoApostasDemo.unshift({ dataHora, direcao: apostaAtiva.direcao, valor: apostaAtiva.valor.toFixed(4), resultado: ganhou ? "Ganhou" : "Perdeu" });
                if (historicoApostasDemo.length > 10) historicoApostasDemo.pop();
            } else {
                if (ganhou) {
                    saldoDepositado += apostaAtiva.valor * 2;
                    localStorage.setItem('saldoDepositado', saldoDepositado);
                }
                atualizarExibicaoCarteira();
                document.getElementById("resultado").innerText = ganhou ? "Você ganhou!" : "Você perdeu!";
                const dataHora = new Date().toLocaleString('pt-BR');
                historicoApostas.unshift({ dataHora, direcao: apostaAtiva.direcao, valor: apostaAtiva.valor.toFixed(4), resultado: ganhou ? "Ganhou" : "Perdeu" });
                if (historicoApostas.length > 10) historicoApostas.pop();
            }
            if (ganhou) {
                document.getElementById("winSound").play().catch(error => console.log("Erro ao tocar som:", error));
            } else {
                document.getElementById("loseSound").play().catch(error => console.log("Erro ao tocar som:", error));
            }
            atualizarHistórico();
            apostaAtiva = null;
            criptomoedas[criptoAtual].chart.update();
        }

        function atualizarHistórico() {
            const historyBody = document.getElementById("historyBody");
            historyBody.innerHTML = "";
            const histórico = isDemoMode ? historicoApostasDemo : historicoApostas;
            histórico.forEach(aposta => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${aposta.dataHora}</td>
                    <td>${aposta.direcao.charAt(0).toUpperCase() + aposta.direcao.slice(1)}</td>
                    <td>${aposta.valor}</td>
                    <td>${aposta.resultado}</td>
                `;
                historyBody.appendChild(row);
            });
        }

        async function transferirSaldo() {
            if (isDemoMode) {
                alert("Transferências desativadas no modo demo!");
                return;
            }
            if (saldoDepositado <= 0) {
                alert("Saldo insuficiente!");
                return;
            }
            if (saldoDepositado < MINIMO_SAQUE) {
                alert(`Mínimo para saque: ${MINIMO_SAQUE} BNB! Saldo atual: ${saldoDepositado.toFixed(4)} BNB`);
                return;
            }
            let carteiraDestino = prompt("Carteira BNB de destino:");
            if (!carteiraDestino) {
                alert("Endereço obrigatório!");
                return;
            }
            let valorTransferencia = saldoDepositado;
            try {
                await atualizarSaldoReal();
                if (saldoReal < valorTransferencia) {
                    alert(`Saldo real insuficiente na carteira! Saldo atual: ${saldoReal.toFixed(4)} BNB`);
                    return;
                }
                const valorWei = web3.utils.toWei(valorTransferencia.toString(), 'ether');
                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: carteiraBNB,
                        to: carteiraDestino,
                        value: web3.utils.toHex(valorWei),
                    }],
                });
                const recibo = await web3.eth.getTransactionReceipt(txHash);
                if (recibo && recibo.status) {
                    saldoDepositado = 0;
                    localStorage.setItem('saldoDepositado', saldoDepositado);
                    valorTotalSite -= valorTransferencia;
                    localStorage.setItem('valorTotalSite', valorTotalSite);
                    atualizarExibicaoCarteira();
                    atualizarPainelProprietario();
                    simularSaques(valorTransferencia, carteiraDestino); // Adiciona o saque real à lista
                    alert(`Transferência de ${valorTransferencia} BNB para ${carteiraDestino} realizada!`);
                } else {
                    alert("Falha na transação.");
                }
            } catch (error) {
                alert("Erro ao transferir: " + error.message);
            }
        }

        function realizarDeposito() {
            if (isDemoMode) {
                const valorDeposito = parseFloat(prompt("Modo Demo: Valor em BNB:"));
                if (valorDeposito && valorDeposito > 0) {
                    saldoDemo += valorDeposito;
                    atualizarExibicaoCarteira();
                    alert(`Depósito simulado de ${valorDeposito} BNB concluído!`);
                } else {
                    alert("Valor inválido!");
                }
                return;
            }
            if (!carteiraBNB) {
                alert("Conecte a carteira primeiro!");
                return;
            }
            document.getElementById("depositoModal").style.display = "block";
        }

        function fecharJanelaDeposito() {
            document.getElementById("depositoModal").style.display = "none";
            document.getElementById("valorDeposito").value = "";
            document.getElementById("statusDeposito").innerText = "Status: Aguardando ação...";
        }

        async function depositarBNB() {
            if (isDemoMode) {
                alert("Desative o modo demo para depósitos reais!");
                return;
            }
            if (!window.ethereum) {
                alert("Instale o MetaMask!");
                return;
            }
            const valorDeposito = parseFloat(document.getElementById("valorDeposito").value);
            if (!valorDeposito || valorDeposito <= 0) {
                alert("Valor inválido!");
                return;
            }
            try {
                document.getElementById("statusDeposito").innerText = "Aguardando MetaMask...";
                const valorWei = web3.utils.toWei(valorDeposito.toString(), 'ether');
                const enderecoDestino = CARTEIRA_PROPRIETARIA;
                const txHash = await window.ethereum.request({
                    method: 'eth_sendTransaction',
                    params: [{
                        from: carteiraBNB,
                        to: enderecoDestino,
                        value: web3.utils.toHex(valorWei),
                    }],
                });
                document.getElementById("statusDeposito").innerText = `Transação enviada! Hash: ${txHash}`;
                const recibo = await web3.eth.getTransactionReceipt(txHash);
                if (recibo && recibo.status) {
                    saldoDepositado += valorDeposito;
                    localStorage.setItem('saldoDepositado', saldoDepositado);
                    valorTotalSite += valorDeposito;
                    localStorage.setItem('valorTotalSite', valorTotalSite);
                    atualizarExibicaoCarteira();
                    document.getElementById("statusDeposito").innerText = "Depósito concluído!";
                    atualizarPainelProprietario();
                    if (codigoAfiliadoInserido && afiliados[codigoAfiliadoInserido] && afiliados[codigoAfiliadoInserido].carteira !== carteiraBNB) {
                        const bonusAfiliado = valorDeposito * 0.1;
                        afiliados[codigoAfiliadoInserido].valor = (afiliados[codigoAfiliadoInserido].valor || 0) + bonusAfiliado;
                        if (afiliados[codigoAfiliadoInserido].carteira === carteiraBNB) {
                            valorAfiliado = afiliados[codigoAfiliadoInserido].valor;
                            atualizarStatsAfiliado();
                        }
                    }
                    setTimeout(fecharJanelaDeposito, 2000);
                } else {
                    document.getElementById("statusDeposito").innerText = "Falha na transação.";
                }
            } catch (error) {
                document.getElementById("statusDeposito").innerText = `Erro: ${error.message}`;
            }
        }

        function abrirJanelaSuporte() {
            document.getElementById("suporteModal").style.display = "block";
        }

        function fecharJanelaSuporte() {
            document.getElementById("suporteModal").style.display = "none";
            document.getElementById("mensagemSuporte").value = "";
        }

        function enviarMensagemSuporte() {
            const mensagem = document.getElementById("mensagemSuporte").value;
            if (!mensagem) {
                alert("Digite uma mensagem!");
                return;
            }
            const emailSubject = "Suporte - QUOXT SS";
            const emailBody = `Mensagem:\n\n${mensagem}`;
            window.location.href = `mailto:thiagoecamila5505@gmail.com?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
            fecharJanelaSuporte();
        }

        function gerarCodigoAfiliado() {
            if (!carteiraBNB) {
                alert("Conecte uma carteira BNB primeiro!");
                return;
            }
            if (isDemoMode) {
                alert("O programa de afiliados não está disponível no modo demo!");
                return;
            }
            if (afiliadoCode) {
                alert("Você já possui um código de afiliado: " + afiliadoCode);
                return;
            }
            afiliadoCode = `AF${Math.random().toString(36).substr(2, 8).toUpperCase()}`;
            afiliados[afiliadoCode] = { carteira: carteiraBNB, usuarios: 0, valor: 0 };
            document.getElementById("affiliateCode").innerText = `Seu código de afiliado: ${afiliadoCode}`;
            alert(`Seu código de afiliado: ${afiliadoCode}`);
            atualizarStatsAfiliado();
        }

        function atualizarStatsAfiliado() {
            if (afiliadoCode && afiliados[afiliadoCode]) {
                usuariosAfiliados = afiliados[afiliadoCode].usuarios;
                valorAfiliado = afiliados[afiliadoCode].valor;
                document.getElementById("usuariosAfiliados").innerText = usuariosAfiliados;
                document.getElementById("valorAfiliado").innerText = valorAfiliado.toFixed(4);
            } else {
                document.getElementById("usuariosAfiliados").innerText = 0;
                document.getElementById("valorAfiliado").innerText = "0.0000";
            }
        }

        function solicitarSaqueAfiliado() {
            if (!carteiraBNB) {
                alert("Conecte uma carteira BNB primeiro!");
                return;
            }
            if (isDemoMode) {
                alert("Saques de afiliados não estão disponíveis no modo demo!");
                return;
            }
            if (!afiliadoCode || !afiliados[afiliadoCode]) {
                alert("Você precisa ser um afiliado para solicitar saque!");
                return;
            }
            if (valorAfiliado <= 0) {
                alert("Nenhum valor disponível para saque!");
                return;
            }
            const emailSubject = "Solicitação de Saque - Afiliado";
            const emailBody = `Carteira BNB: ${carteiraBNB}\nCódigo de Afiliado: ${afiliadoCode}\nValor para saque: ${valorAfiliado.toFixed(4)} BNB`;
            window.location.href = `mailto:zuzukoficial@gmail.com?subject=${encodeURIComponent(emailSubject)}&body=${encodeURIComponent(emailBody)}`;
            atualizarStatsAfiliado();
        }

        let saquesLista = [];
        function simularSaques(valorReal = null, carteiraReal = null) {
            const saquesList = document.getElementById("saquesList");
            if (valorReal && carteiraReal) {
                // Saque real realizado pelo usuário
                const dataHora = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                saquesLista.unshift({ carteira: `${carteiraReal.slice(0, 6)}...${carteiraReal.slice(-4)}`, valor: valorReal.toFixed(4), dataHora });
            } else {
                // Simulação de saques fictícios
                const carteirasFicticias = ["0xA1b2...c3d4", "0xE5f6...g7h8", "0xI9j0...k1l2", "0xM3n4...o5p6", "0xQ7r8...s9t0"];
                const valorSaque = (Math.random() * (0.5 - 0.02) + 0.02).toFixed(4);
                const carteira = carteirasFicticias[Math.floor(Math.random() * carteirasFicticias.length)];
                const dataHora = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
                saquesLista.unshift({ carteira, valor: valorSaque, dataHora });
            }
            if (saquesLista.length > 5) saquesLista.pop();
            saquesList.innerHTML = "";
            saquesLista.forEach(saque => {
                const item = document.createElement("div");
                item.classList.add("saque-item");
                item.innerHTML = `<span>${saque.carteira} - ${saque.dataHora}</span><span class="saque-valor">${saque.valor} BNB</span>`;
                saquesList.appendChild(item);
            });
        }

        function iniciarSimulacaoSaques() {
            simularSaques();
            setInterval(() => simularSaques(), Math.random() * (15000 - 5000) + 5000);
        }

        async function abrirJanelaProprietario() {
            if (carteiraBNB.toLowerCase() !== CARTEIRA_PROPRIETARIA.toLowerCase()) {
                alert("Acesso restrito ao proprietário!");
                return;
            }
            document.getElementById("proprietarioModal").style.display = "block";
            await atualizarPainelProprietario();
        }

        function fecharJanelaProprietario() {
            document.getElementById("proprietarioModal").style.display = "none";
            if (dificuldadeChart) {
                dificuldadeChart.destroy();
                dificuldadeChart = null;
            }
            document.getElementById("dificuldadeChartContainer").style.display = "none";
        }

        async function atualizarPainelProprietario() {
            if (carteiraBNB.toLowerCase() !== CARTEIRA_PROPRIETARIA.toLowerCase()) return;
            const contasLogadasDiv = document.getElementById("contasLogadas");
            contasLogadasDiv.innerHTML = "<h3>Contas Logadas</h3>";
            for (let i = 0; i < contasLogadas.length; i++) {
                const balanceWei = await web3.eth.getBalance(contasLogadas[i].carteira);
                contasLogadas[i].saldo = parseFloat(web3.utils.fromWei(balanceWei, 'ether'));
                const item = document.createElement("div");
                item.classList.add("conta-item");
                item.innerHTML = `<span>${contasLogadas[i].carteira.slice(0, 6)}...${contasLogadas[i].carteira.slice(-4)}</span><span>${contasLogadas[i].saldo.toFixed(4)} BNB</span>`;
                contasLogadasDiv.appendChild(item);
            }
            document.getElementById("valorTotalSite").innerText = valorTotalSite.toFixed(4);
        }

        function toggleDificuldadeChart() {
            const toggleBtn = document.getElementById("toggleChartBtn");
            const chartContainer = document.getElementById("dificuldadeChartContainer");
            dificuldadeChartAtivo = !dificuldadeChartAtivo;
            if (dificuldadeChartAtivo) {
                toggleBtn.textContent = "Desativar Gráfico Dificuldade";
                toggleBtn.classList.remove("off");
                chartContainer.style.display = "block";
                if (!dificuldadeChart) {
                    const ctx = document.getElementById("dificuldadeChart").getContext('2d');
                    dificuldadeChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: Array.from({ length: 10 }, (_, i) => `${i + 1}m`),
                            datasets: [{
                                label: 'Dificuldade',
                                data: Array.from({ length: 10 }, () => Math.random() * 100),
                                borderColor: '#f0b90b',
                                borderWidth: 2,
                                fill: false
                            }]
                        },
                        options: {
                            scales: {
                                y: { beginAtZero: true, grid: { color: '#2e2e2e' }, ticks: { color: '#ffffff' } },
                                x: { grid: { color: '#2e2e2e' }, ticks: { color: '#ffffff' } }
                            },
                            plugins: { legend: { display: false } }
                        }
                    });
                }
            } else {
                toggleBtn.textContent = "Ativar Gráfico Dificuldade";
                toggleBtn.classList.add("off");
                chartContainer.style.display = "none";
                if (dificuldadeChart) {
                    dificuldadeChart.destroy();
                    dificuldadeChart = null;
                }
            }
        }

        window.onload = function() {
            simularUsuariosAtivos(); // Chama imediatamente para evitar "0" inicial
            iniciarSimulacaoSaques();
            tentarReconectarCarteira();
            atualizarExibicaoCarteira();
        };
    </script>
</body>
</html>
